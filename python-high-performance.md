[toc]

# Numpy高性能计算

## 使用适合的数据类型

### np.matmul 修改数据类型

之前遇到过一个场景，进行 (26046, 100) 大小的矩阵和 (100，71904) 大小的矩阵乘积。结果很大，占用许多内存。

使用 .dtype 查看结果的类型，发现是 float64，然后使用 sys.getsizeof 查看大小，发现占了 1多G

之后在进行乘积时使用 dtype 指定结果的类型后，输出的大小小了许多

```
result = np.matmul(u, p, dtype=np.float32)
```

不过其中有一个问题。dtype=np.float32 时结果的计算很迅速，result 的内存占用也少了许多。因此深度使用 dtype=np.float16，原本希望着可以将内存占用减得更小，结果发现计算很慢，不知道是什么原因。 在这里记录一下，看来将 float64 转化为 float32 是比较合适的。